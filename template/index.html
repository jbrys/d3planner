<%inherit file="/base.html"/>
<script type="text/javascript">
    var _affix;
    var _slots = {};
    var _valid_slots = ["head"];
    var _char = {};

    function item_change(){
        var ddl = $(this);
        var slot = ddl.parents(".slot").prop("id");
        var item_name = ddl.children("option:selected").text();
        var item = _slots[slot].items[item_name];

        if(!item.joined){
            $.each(_affix.primary[slot], function(stat,value){
                if(item.primary)
                    item.primary[stat] = value;

            });
            item.joined = true;
        }

        $("#"+slot+" .affix .primary select").empty();
        if(item.primary) {
            $("#"+slot+" .affix .primary select").append($("<option></option>").text(""));
            $.each(item.primary, function(stat,value){
                $("#"+slot+" .affix .primary select")
                    .append($("<option></option>").text(stat));
            });
        }
        $("#"+slot+ " .chosen-select").trigger("chosen:updated");
    }
    function clear_slot(item_ddl){
        item_ddl.empty();
        item_ddl.append($("<option></option>").text(""));
    }
    function load_slot(slot, item_ddl, group){
        $.getJSON("${base}json/"+slot, function(data) {
            _slots[slot] = data;
            if (item_ddl.hasClass("group")){
                parent_item = $("<optgroup></optgroup>").attr("label",slot);
                item_ddl.append(parent_item);
            }
            else{
                parent_item = item_ddl;
            }
            $.each(data.items, function(key, item) {
                parent_item.append($("<option></option>").text(key));
            });
        });
    }
    function load_ddl(item_ddl){
        clear_slot(item_ddl);
        $.each(item_ddl.attr("class").split(/\s+/), function(i, slot){
            if($.inArray(slot, _valid_slots) > -1){
                load_slot(slot, item_ddl, false);
            }
        });
        item_ddl.parent().children(".chosen-select").trigger("chosen:updated");
    }
    $(document).ready(function(){
        $(".item").change(item_change);
        $.getJSON("${base}json/affix", function(affix) {
            _affix = affix;
        });
        $(".item").each(function(i, item_ddl){
            load_ddl($(item_ddl));
        });

        $(".edit_button a").click(function(){
            $(this)
                .parents(".view").hide()
                .parents(".slot").children(".edit").show()
                .find(".chosen-select").chosen();
            return false;
        });
        $(".cancel_button a").click(function(){
            $(this)
                .parents(".edit").hide()
                .parents(".slot").children(".view").show();
            return false;
        });
        $(".save_button a").click(function(){
            $(this)
                .parents(".edit").hide()
                .parents(".slot").children(".view").show();
            return false;
        });
    });
</script>
<div class ="center_contents">
    <div class="paperdoll">
        <div class="equipment_row">
            <div class="slot" id="shoulders">
                shoulders
                <br>
                <div class="edit">
                    <select class="item shoulders chosen-select"></select>
                    <div class="affix">
                        <div class="primary">
                            <select multiple class="chosen-select"></select>
                        </div>
                    </div>
                    <div class="buttons">
                        <div class="save_button"><a href="#">save</a></div>
                        <div class="cancel_button"><a href="#">cancel</a></div>
                    </div>
                </div>
                <div class="view">
                    <div class="name"></div>
                    <div class="affixes"></div>
                    <div class="buttons">
                        <div class="edit_button"><a href="#">edit</a></div>
                    </div>
                </div>
            </div>
            <div class="slot" id="head">
                head
                <br>
                <div class="edit">
                    <select class="item head chosen-select"></select>
                    <div class="affix">
                        <div class="primary">
                            <select multiple class="chosen-select"></select>
                        </div>
                    </div>
                    <div class="buttons">
                        <div class="save_button"><a href="#">save</a></div>
                        <div class="cancel_button"><a href="#">cancel</a></div>
                    </div>
                </div>
                <div class="view">
                    <div class="name"></div>
                    <div class="affixes"></div>
                    <div class="buttons">
                        <div class="edit_button"><a href="#">edit</a></div>
                    </div>
                </div>
            </div>
            <div class="slot" id="neck">
                neck
                <br>
                <div class="edit">
                    <select class="item neck chosen-select"></select>
                    <div class="affix">
                        <div class="primary">
                            <select multiple class="chosen-select"></select>
                        </div>
                    </div>
                    <div class="buttons">
                        <div class="save_button"><a href="#">save</a></div>
                        <div class="cancel_button"><a href="#">cancel</a></div>
                    </div>
                </div>
                <div class="view">
                    <div class="name"></div>
                    <div class="affixes"></div>
                    <div class="buttons">
                        <div class="edit_button"><a href="#">edit</a></div>
                    </div>
                </div>
            </div>
        </div>
        <div style="clear: both;"></div>
        <div class="equipment_row">
            <div class="slot" id="hands">
                hands
                <br>
                <div class="edit">
                    <select class="item hands chosen-select"></select>
                    <div class="affix">
                        <div class="primary">
                            <select multiple class="chosen-select"></select>
                        </div>
                    </div>
                    <div class="buttons">
                        <div class="save_button"><a href="#">save</a></div>
                        <div class="cancel_button"><a href="#">cancel</a></div>
                    </div>
                </div>
                <div class="view">
                    <div class="name"></div>
                    <div class="affixes"></div>
                    <div class="buttons">
                        <div class="edit_button"><a href="#">edit</a></div>
                    </div>
                </div>
            </div>
            <div class="slot" id="chest">
                chest
                <br>
                <div class="edit">
                    <select class="item chest chosen-select"></select>
                    <div class="affix">
                        <div class="primary">
                            <select multiple class="chosen-select"></select>
                        </div>
                    </div>
                    <div class="buttons">
                        <div class="save_button"><a href="#">save</a></div>
                        <div class="cancel_button"><a href="#">cancel</a></div>
                    </div>
                </div>
                <div class="view">
                    <div class="name"></div>
                    <div class="affixes"></div>
                    <div class="buttons">
                        <div class="edit_button"><a href="#">edit</a></div>
                    </div>
                </div>
            </div>
            <div class="slot" id="wrists">
                wrists
                <br>
                <div class="edit">
                    <select class="item wrists chosen-select"></select>
                    <div class="affix">
                        <div class="primary">
                            <select multiple class="chosen-select"></select>
                        </div>
                    </div>
                    <div class="buttons">
                        <div class="save_button"><a href="#">save</a></div>
                        <div class="cancel_button"><a href="#">cancel</a></div>
                    </div>
                </div>
                <div class="view">
                    <div class="name"></div>
                    <div class="affixes"></div>
                    <div class="buttons">
                        <div class="edit_button"><a href="#">edit</a></div>
                    </div>
                </div>
            </div>
        </div>
        <div style="clear: both;"></div>
        <div class="equipment_row">
            <div class="slot" id="lfinger">
                finger
                <br>
                <div class="edit">
                    <select class="item finger chosen-select"></select>
                    <div class="affix">
                        <div class="primary">
                            <select multiple class="chosen-select"></select>
                        </div>
                    </div>
                    <div class="buttons">
                        <div class="save_button"><a href="#">save</a></div>
                        <div class="cancel_button"><a href="#">cancel</a></div>
                    </div>
                </div>
                <div class="view">
                    <div class="name"></div>
                    <div class="affixes"></div>
                    <div class="buttons">
                        <div class="edit_button"><a href="#">edit</a></div>
                    </div>
                </div>
            </div>
            <div class="slot" id="waist">
                waist
                <br>
                <div class="edit">
                    <select class="item waist chosen-select"></select>
                    <div class="affix">
                        <div class="primary">
                            <select multiple class="chosen-select"></select>
                        </div>
                    </div>
                    <div class="buttons">
                        <div class="save_button"><a href="#">save</a></div>
                        <div class="cancel_button"><a href="#">cancel</a></div>
                    </div>
                </div>
                <div class="view">
                    <div class="name"></div>
                    <div class="affixes"></div>
                    <div class="buttons">
                        <div class="edit_button"><a href="#">edit</a></div>
                    </div>
                </div>
            </div>
            <div class="slot" id="rfinger">
                finger
                <br>
                <div class="edit">
                    <select class="item finger chosen-select"></select>
                    <div class="affix">
                        <div class="primary">
                            <select multiple class="chosen-select"></select>
                        </div>
                    </div>
                    <div class="buttons">
                        <div class="save_button"><a href="#">save</a></div>
                        <div class="cancel_button"><a href="#">cancel</a></div>
                    </div>
                </div>
                <div class="view">
                    <div class="name"></div>
                    <div class="affixes"></div>
                    <div class="buttons">
                        <div class="edit_button"><a href="#">edit</a></div>
                    </div>
                </div>
            </div>
        </div>
        <div style="clear: both;"></div>
        <div class="equipment_row">
            <div class="slot" id="mainhand">
                mainhand
                <br>
                <div class="edit">
                    <select class="item group onehand twohand chosen-select"></select>
                    <div class="affix">
                        <div class="primary">
                            <select multiple class="chosen-select"></select>
                        </div>
                    </div>
                    <div class="buttons">
                        <div class="save_button"><a href="#">save</a></div>
                        <div class="cancel_button"><a href="#">cancel</a></div>
                    </div>
                </div>
                <div class="view">
                    <div class="name"></div>
                    <div class="affixes"></div>
                    <div class="buttons">
                        <div class="edit_button"><a href="#">edit</a></div>
                    </div>
                </div>
            </div>
            <div class="slot" id="legs">
                legs
                <br>
                <div class="edit">
                    <select class="item legs chosen-select"></select>
                    <div class="affix">
                        <div class="primary">
                            <select multiple class="chosen-select"></select>
                        </div>
                    </div>
                    <div class="buttons">
                        <div class="save_button"><a href="#">save</a></div>
                        <div class="cancel_button"><a href="#">cancel</a></div>
                    </div>
                </div>
                <div class="view">
                    <div class="name"></div>
                    <div class="affixes"></div>
                    <div class="buttons">
                        <div class="edit_button"><a href="#">edit</a></div>
                    </div>
                </div>
            </div>
            <div class="slot" id="offhand">
                offhand
                <br>
                <div class="edit">
                    <select class="item group shield mojo source quiver cshield chosen-select"></select>
                    <div class="affix">
                        <div class="primary">
                            <select multiple class="chosen-select"></select>
                        </div>
                    </div>
                    <div class="buttons">
                        <div class="save_button"><a href="#">save</a></div>
                        <div class="cancel_button"><a href="#">cancel</a></div>
                    </div>
                </div>
                <div class="view">
                    <div class="name"></div>
                    <div class="affixes"></div>
                    <div class="buttons">
                        <div class="edit_button"><a href="#">edit</a></div>
                    </div>
                </div>
            </div>
        </div>
        <div style="clear: both;"></div>
        <div class="equipment_row">
            <div class="slot" id="feet">
                feet
                <br>
                <div class="edit">
                    <select class="item feet chosen-select"></select>
                    <div class="affix">
                        <div class="primary">
                            <select multiple class="chosen-select"></select>
                        </div>
                    </div>
                    <div class="buttons">
                        <div class="save_button"><a href="#">save</a></div>
                        <div class="cancel_button"><a href="#">cancel</a></div>
                    </div>
                </div>
                <div class="view">
                    <div class="name"></div>
                    <div class="affixes"></div>
                    <div class="buttons">
                        <div class="edit_button"><a href="#">edit</a></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>