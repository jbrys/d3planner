<%inherit file="/base.html"/>
<script type="text/javascript">
    var _affix;
    var _slots = {};

    function item_change(){
        var ddl = $(this);
        var slot = ddl.parent().prop("id");
        var item_name = ddl.children("option:selected").text();
        var item = _slots[slot].items[item_name];

        if(!item.joined){
            $.each(_affix.primary[slot], function(stat,value){
                if(item.primary)
                    item.primary[stat] = value;

            });
            item.joined = true;
        }

        $("#"+slot+" .affix .primary select").empty();
        if(item.primary) {
            $("#"+slot+" .affix .primary select").append($("<option></option>").text(""));
            $.each(item.primary, function(stat,value){
                $("#"+slot+" .affix .primary select")
                    .append($("<option></option>").text(stat));
            });
        }
    }

    $(document).ready(function(){
        $(".item").change(item_change);
        $.getJSON("${base}json/affix", function(affix) {
            _affix = affix;
        });
        $(".slot").each(function(i, slot_div){
            var slot = slot_div.id;
            $.getJSON("${base}json/"+slot, function(data) {
                _slots[slot] = data;
                $("#"+slot+" .item")
                         .append($("<option></option>")
                            .text(""));
                $.each(data.items, function(key, item) {
                    $("#"+slot+" .item")
                         .append($("<option></option>")
                            .text(key));
                });
            });
        });
    });
</script>
<div class="slot" id="head">
    <select class="item"></select>
    <div class="affix">
        <div class="primary">
            <select class="1"></select><br>
            <select class="2"></select><br>
            <select class="3"></select><br>
            <select class="4"></select><br>
        </div>
    </div>
</div>